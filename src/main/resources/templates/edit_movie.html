<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit Movie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5 p-5">
    <h1 class="text-center">Edit Movie</h1>

    <form id="editMovieForm">
        <div class="mb-3">
            <label for="title" class="form-label">Movie Title</label>
            <input type="text" class="form-control" id="title" name="title" th:value="${movie.title}" required>
        </div>

        <div class="mb-3">
            <label for="review" class="form-label">Review</label>
            <textarea class="form-control" id="review" name="review" required th:text="${movie.review}"></textarea>
        </div>

        <div class="mb-3">
            <label for="star" class="form-label">Star Rating (1-5)</label>
            <input type="number" class="form-control" id="star" name="star" min="1" max="5" th:value="${movie.star}" required>
        </div>

        <button type="button" class="btn btn-primary" onclick="updateMovie()">Update Movie</button>
    </form>
</div>

<script>
    function updateMovie() {
        const urlParts = window.location.pathname.split('/');
        const movieId = urlParts[urlParts.length - 1];

        const title = document.getElementById("title").value;
        const review = document.getElementById("review").value;
        const star = document.getElementById("star").value;

        const movieData = {
            title: title,
            review: review,
            star: parseInt(star)
        };

        fetch(`/movies/${movieId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(movieData)
        })
            .then(response => {
                if (response.ok) {
                    window.location.href = "/movies/view";
                } else {
                    alert('Failed to update the movie');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
</script>
</body>
</html>
