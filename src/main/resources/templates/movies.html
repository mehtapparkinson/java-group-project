<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Movie Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">ðŸŽ¥ Welcome to CineLog</h1>
    <p class="text-center lead">Keep track of your favorite movies and reviews</p>
    <br>
    <h2 class="text-center" >Movie Diary</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Title</th>
            <th>Review</th>
            <th>Stars</th>
            <th>Added At</th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="movie : ${movies}">
            <td th:text="${movie.title}"></td>
            <td th:text="${movie.review}"></td>
            <td th:text="${movie.star}"></td>
            <td th:text="${movie.date}"></td>
            <td>
                <a th:href="@{/movies/edit/{movieId}(movieId=${movie.movie_id})}" class="btn btn-primary">Edit</a>
            </td>
            <td>
                <button class="btn btn-danger" th:onclick="'deleteMovie(' + ${movie.movie_id} + ')'">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>
    <h5 class="text-center" >Your Total Movies: <span th:text="${movies.size()}"></span></h5>
    <h5 class="text-center" >Your Average Rating: <span th:text="${avgRating}"></span></h5>
    <br>
    <h2 class="text-center">Add New Movie</h2>
    <form class="mb-5" action="#" th:action="@{/movies}" method="post">
        <div class="mb-3">
            <label for="title" class="form-label">Movie Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="mb-3">
            <label for="review" class="form-label">Review</label>
            <textarea class="form-control" id="review" name="review" required></textarea>
        </div>
        <div class="mb-3">
            <label for="star" class="form-label">Star Rating (1-5)</label>
            <input type="number" class="form-control" id="star" name="star" min="1" max="5" required>
        </div>
        <button type="submit" class="btn btn-primary">Add Movie</button>
    </form>
</div>

<script>
    function deleteMovie(movieId) {
        if(confirm('Are you sure you want to delete this movie?')) {
            fetch('/movies/' + movieId, {
                method: 'DELETE'
            }).then(response => {
                if(response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to delete the movie.');
                }
            });
        }
    }
</script>

</body>
</html>
